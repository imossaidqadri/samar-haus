{% comment %}
  Renders product variant-picker

  Accepts:
  - product: {Object} product object.
  - block: {Object} passing the block information.
  - product_form_id: {String} Id of the product form to which the variant picker is associated.
  Usage:
  {% render 'product-variant-picker', product: product, block: block, product_form_id: product_form_id %}
{% endcomment %}
{%- unless product.has_only_default_variant -%}
  <variant-selects
    id="variant-selects-{{ section.id }}"
    data-section="{{ section.id }}"
    {{ block.shopify_attributes }}
  >
    {%- for option in product.options_with_values -%}
      {%- liquid
        assign swatch_count = option.values | map: 'swatch' | compact | size
        assign picker_type = block.settings.picker_type

        if swatch_count > 0 and block.settings.swatch_shape != 'none'
          if block.settings.picker_type == 'dropdown'
            assign picker_type = 'swatch_dropdown'
          else
            assign picker_type = 'swatch'
          endif
        endif
      -%}
      {%- if picker_type == 'swatch' -%}
        <fieldset class="mb-4">
          <legend class="text-sm font-medium text-gray-900 mb-2 uppercase">
            {{ option.name }}
          </legend>
          {% render 'product-variant-options',
            product: product,
            option: option,
            block: block,
            picker_type: picker_type
          %}
        </fieldset>
      {%- elsif picker_type == 'button' -%}
        <fieldset class="mb-4">
          <legend class="text-sm font-medium text-gray-900 mb-2 uppercase">{{ option.name }}</legend>
          {% render 'product-variant-options',
            product: product,
            option: option,
            block: block,
            picker_type: picker_type
          %}
        </fieldset>
      {%- else -%}
        <div class="aakam-size-selector">
          <label class="aakam-size-label" for="Option-{{ section.id }}-{{ forloop.index0 }}">
            {{ option.name }}
          </label>
          <div class="aakam-dropdown-wrapper">
            <select
              id="Option-{{ section.id }}-{{ forloop.index0 }}"
              class="aakam-dropdown"
              name="options[{{ option.name | escape }}]"
              form="{{ product_form_id }}"
            >
              {% render 'product-variant-options',
                product: product,
                option: option,
                block: block,
                picker_type: picker_type
              %}
            </select>
            <div class="aakam-dropdown-arrow">
              <svg class="aakam-arrow-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </div>
          </div>
        </div>

        <style>
          .aakam-size-selector {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 32px;
            width: 100%;
          }

          .aakam-size-label {
            font-family: "Yantramanav", sans-serif;
            font-size: 13px;
            font-weight: 400;
            letter-spacing: 0.8px;
            text-transform: uppercase;
            color: #000;
            white-space: nowrap;
            margin: 0;
          }

          .aakam-dropdown-wrapper {
            position: relative;
            flex: 0.8;
          }

          .aakam-dropdown {
            width: 100%;
            padding: 8px 12px;
            padding-right: 32px;
            border: 1px solid #000;
            background: white;
            font-family: "Yantramanav", sans-serif;
            font-size: 13px;
            font-weight: 300;
            color: #000;
            appearance: none;
            cursor: pointer;
            outline: none;
          }

          .aakam-dropdown:focus {
            border-color: #000;
          }

          .aakam-dropdown-arrow {
            position: absolute;
            top: 50%;
            right: 8px;
            transform: translateY(-50%);
            pointer-events: none;
          }

          .aakam-arrow-icon {
            width: 16px;
            height: 16px;
            stroke: #000;
            stroke-width: 1.5;
          }
        </style>
      {%- endif -%}
    {%- endfor -%}

    <script type="application/json" data-selected-variant>
      {{ product.selected_or_first_available_variant | json }}
    </script>
  </variant-selects>
{%- endunless -%}
