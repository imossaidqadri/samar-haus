{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'template-collection.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .collection-hero {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    padding: 80px 0 60px;
    text-align: center;
  }
  
  .collection-title {
    font-size: 2.5rem;
    font-weight: 300;
    letter-spacing: 2px;
    margin-bottom: 10px;
    color: #333;
  }
  
  .collection-description {
    font-size: 1.1rem;
    color: #666;
    max-width: 600px;
    margin: 0 auto;
  }
  
  .collection-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 40px;
    padding: 20px 0;
    border-bottom: 1px solid #eee;
  }
  
  .collection-count {
    font-size: 0.9rem;
    color: #666;
  }
  
  .collection-sort {
    display: flex;
    align-items: center;
    gap: 15px;
  }
  
  .sort-select {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    background: white;
    font-size: 0.9rem;
  }
  
  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 40px 30px;
    margin-bottom: 60px;
  }
  
  .product-card {
    background: white;
    border-radius: 8px;
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    position: relative;
  }
  
  .product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
  }
  
  .product-image-wrapper {
    position: relative;
    overflow: hidden;
    aspect-ratio: 3/4;
  }
  
  .product-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }
  
  .product-card:hover .product-image {
    transform: scale(1.05);
  }
  
  .product-badge {
    position: absolute;
    top: 15px;
    left: 15px;
    padding: 5px 10px;
    font-size: 0.8rem;
    font-weight: 500;
    border-radius: 15px;
    z-index: 2;
  }
  
  .badge-sale {
    background: #ff4757;
    color: white;
  }
  
  .badge-sold-out {
    background: #666;
    color: white;
  }
  
  .product-info {
    padding: 20px;
  }
  
  .product-title {
    font-size: 1rem;
    font-weight: 400;
    margin-bottom: 8px;
    color: #333;
    line-height: 1.3;
  }
  
  .product-price {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
  }
  
  .price-current {
    font-size: 1.1rem;
    font-weight: 600;
    color: #333;
  }
  
  .price-original {
    font-size: 0.9rem;
    color: #999;
    text-decoration: line-through;
  }
  
  .quick-add-btn {
    width: 100%;
    padding: 12px;
    background: #333;
    color: white;
    border: none;
    border-radius: 4px;
    font-size: 0.9rem;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  
  .quick-add-btn:hover {
    background: #555;
  }
  
  .quick-add-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
  }
  
  .pagination-wrapper {
    text-align: center;
    margin-top: 60px;
  }
  
  .pagination {
    display: inline-flex;
    gap: 10px;
    align-items: center;
  }
  
  .pagination a,
  .pagination span {
    padding: 10px 15px;
    border: 1px solid #ddd;
    text-decoration: none;
    color: #333;
    border-radius: 4px;
    transition: all 0.3s ease;
  }
  
  .pagination a:hover {
    background: #333;
    color: white;
    border-color: #333;
  }
  
  .pagination .current {
    background: #333;
    color: white;
    border-color: #333;
  }
  
  @media (max-width: 768px) {
    .collection-title {
      font-size: 2rem;
    }
    
    .collection-controls {
      flex-direction: column;
      gap: 15px;
      align-items: stretch;
    }
    
    .product-grid {
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 30px 20px;
    }
    
    .product-info {
      padding: 15px;
    }
  }
{%- endstyle -%}

<div class="collection-page">
  <!-- Collection Hero Section -->
  <div class="collection-hero">
    <div class="page-width">
      <h1 class="collection-title">
        {%- if collection.title -%}
          {{ collection.title }}
        {%- else -%}
          {{ 'collections.general.all_products' | t }}
        {%- endif -%}
      </h1>
      
      {%- if collection.description != blank -%}
        <div class="collection-description">
          {{ collection.description }}
        </div>
      {%- endif -%}
    </div>
  </div>

  <div class="page-width">
    <!-- Collection Controls -->
    <div class="collection-controls">
      <div class="collection-count">
        {{ 'collections.general.items_with_count' | t: count: collection.products_count }}
      </div>
      
      <div class="collection-sort">
        <label for="sort-by">{{ 'collections.sorting.title' | t }}:</label>
        <select name="sort_by" id="sort-by" class="sort-select" onchange="location.href = this.value">
          {%- assign sort_by = collection.sort_by | default: collection.default_sort_by -%}
          {%- for option in collection.sort_options -%}
            <option value="{{ option.value | escape }}" {%- if option.value == sort_by -%} selected="selected"{%- endif -%}>
              {{ option.name | escape }}
            </option>
          {%- endfor -%}
        </select>
      </div>
    </div>

    <!-- Product Grid -->
    {%- if collection.products.size > 0 -%}
      <div class="product-grid">
        {%- for product in collection.products -%}
          <div class="product-card">
            <!-- Product Badges -->
            {%- if product.available == false -%}
              <div class="product-badge badge-sold-out">
                {{ 'products.product.sold_out' | t }}
              </div>
            {%- elsif product.compare_at_price > product.price -%}
              <div class="product-badge badge-sale">
                {{ 'products.product.on_sale' | t }}
              </div>
            {%- endif -%}

            <!-- Product Image -->
            <div class="product-image-wrapper">
              <a href="{{ product.url }}">
                {%- if product.featured_media -%}
                  <img 
                    src="{{ product.featured_media | image_url: width: 400 }}"
                    alt="{{ product.featured_media.alt | escape }}"
                    class="product-image"
                    loading="lazy"
                  >
                {%- else -%}
                  <div class="product-image" style="background: #f5f5f5; display: flex; align-items: center; justify-content: center; color: #999;">
                    {{ 'products.product.no_image' | t }}
                  </div>
                {%- endif -%}
              </a>
            </div>

            <!-- Product Info -->
            <div class="product-info">
              <h3 class="product-title">
                <a href="{{ product.url }}">{{ product.title }}</a>
              </h3>
              
              <div class="product-price">
                <span class="price-current">
                  {{ product.price | money }}
                </span>
                {%- if product.compare_at_price > product.price -%}
                  <span class="price-original">
                    {{ product.compare_at_price | money }}
                  </span>
                {%- endif -%}
              </div>

              <!-- Quick Add Button -->
              {%- if product.available -%}
                {%- if product.variants.size == 1 -%}
                  <form action="/cart/add" method="post" enctype="multipart/form-data">
                    <input type="hidden" name="id" value="{{ product.variants.first.id }}">
                    <button type="submit" class="quick-add-btn">
                      {{ 'products.product.add_to_cart' | t }}
                    </button>
                  </form>
                {%- else -%}
                  <a href="{{ product.url }}" class="quick-add-btn">
                    {{ 'products.product.choose_options' | t }}
                  </a>
                {%- endif -%}
              {%- else -%}
                <button class="quick-add-btn" disabled>
                  {{ 'products.product.sold_out' | t }}
                </button>
              {%- endif -%}
            </div>
          </div>
        {%- endfor -%}
      </div>

      <!-- Pagination -->
      {%- if paginate.pages > 1 -%}
        <div class="pagination-wrapper">
          {%- render 'pagination', paginate: paginate -%}
        </div>
      {%- endif -%}
    {%- else -%}
      <div style="text-align: center; padding: 60px 0;">
        <h2>{{ 'collections.general.no_matches' | t }}</h2>
        <p>{{ 'collections.general.no_products_html' | t }}</p>
      </div>
    {%- endif -%}
  </div>
</div>

{%- paginate collection.products by 24 -%}
{%- endpaginate -%}